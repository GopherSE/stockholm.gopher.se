<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Stockholm.Gopher.SE</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimal-ui">
    <script src="//use.edgefonts.net/kaushan-script:n4.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="container">
      <header>
        <h1 id="headline">Stockholm.Gopher.SE</h1>
      </header>

      <div id="meetup"></div>
    </div>
    <script src="/assets/fittext.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.6.0/moment.min.js"></script>
    <script>
      window.fitText( document.getElementById("headline"), 0.9);

      var $next_meetup_data = null;

      // Get the Meetup event data
      meetup    = document.getElementById('meetup');
      eventsUrl = "https://data.gopher.se/meetup/Go-Stockholm/events.json";

      req = new XMLHttpRequest();
      req.onreadystatechange = function(){
        if (req.readyState == 4 && req.status == 200){
          data = JSON.parse(req.responseText);

          $next_meetup_data = data;

          if(data.results.length == 0) {
            window.location.replace("https://www.meetup.com/Go-Stockholm/");
          }

          if(data.results && data.results[0].announced) {
            event = data.results[0];

            next_meetup_width = meetup.offsetWidth-2;

            meetup.innerHTML += "<div id='next_meetup'>" +
                                "<h2>Next Meetup: <span>" + moment(event.time).format("YYYY-MM-DD HH:mm") + "</span></h2>" +
                                "<h3 class='event_name'>" +
                                "<a href='" + event.event_url + "'>" + event.name + "</a>" +
                                "</h3>" +
                                "<p>" + event.description + "</p>" +
                                "<h3 class='how_to_find_us'>How to find us</h3>" +
                                "<p>" + event.how_to_find_us + "</p>" +
                                "</div>"

            console.log(event);
          }
        }
      }

      req.open("GET", eventsUrl, true);
      req.send();
    </script>
  </body>
</html>
